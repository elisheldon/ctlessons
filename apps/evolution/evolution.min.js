$(document).ready(function(){$.ajax({type:"GET",url:"adaptations.csv",dataType:"text",success:function(e){adaptationsObjArray=$.csv.toObjects(e)}}),$.ajax({type:"GET",url:"birdAdaptations.csv",dataType:"text",success:function(e){birdAdaptationsObjArray=$.csv.toObjects(e)}})});var pTailLength=.1,pMitochondriaSize=.3,pMouthNumber=1,pCiliaNum=0,pWallThickness=1,years=[0],pops=[100],environmentNum="environment1",totalFood=0,bWingSize=.3,bTailSize=.5,bBeakSize=.6,bEyeSize=.5,bBlueness=0,environment1={pTailLength:!0,pMitochondriaSize:!0,pMouthNumber:!0,pCiliaNum:!0,pWallThickness:!1},environment2={pTailLength:!0,pMitochondriaSize:!0,pMouthNumber:!0,pCiliaNum:!0,pWallThickness:!0},environment3={pTailLength:!0,pMitochondriaSize:!0,pMouthNumber:!0,pCiliaNum:!0,pWallThickness:!0},environment4={bWingSize:!0,bTailSize:!0,bBeakSize:!0,bEyeSize:!1,bBlueness:!1},environment5={bWingSize:!0,bTailSize:!0,bBeakSize:!0,bEyeSize:!1,bBlueness:!0},environment6={bWingSize:!0,bTailSize:!0,bBeakSize:!0,bEyeSize:!0,bBlueness:!0};function intro1(){adaptationDiv.innerHTML="First, let's take a look at the components that make up Zoe.<br><br>This is her mitochondrion - her power factory. The larger her mitochondrion grows, the more energy Zoe will have to move around and collect food.<br><br><a href='javascript:intro2()'>Continue</a>",prvwTail.animations.paused=!0,[mitochondriaScaleTween,mitochondriaPosTween]=highlightComponent(prvwMitochondria,3)}function intro2(){adaptationDiv.innerHTML="This is Zoe's flagellum - her tail. The longer her tail grows, the faster she'll be able to move around the water on her hunt for food.<br><br><a href='javascript:intro3()'>Continue</a>",mitochondriaScaleTween.repeat(0),mitochondriaPosTween.repeat(0),prvwTail.animations.paused=!1}function intro3(){adaptationDiv.innerHTML="Zoe is protected from enemies by her cell wall. The thicker her cell wall, the less damage she'll take when she encounters parasites.<br><br><a href='javascript:intro4()'>Continue</a>",prvwTail.animations.paused=!0,[wallScaleTween,wallPosTween]=highlightComponent(prvwWall,1.1)}function intro4(){adaptationDiv.innerHTML="Zoe's 'mouth' is actually a cytostome - a flap within her cell membrane that allows food to enter. The larger her cytostome, the easier it'll be to let the food in!<br><br><a href='javascript:intro5()'>Continue</a>",wallScaleTween.repeat(0),wallPosTween.repeat(0),[mouthScaleTween,mouthPosTween]=highlightComponent(prvwMouth,1.4)}function intro5(){adaptationDiv.innerHTML="Zoe's species may evolve new parts over time, but for now, those are all of the components you need to worry about.<br><br>You may recognize other cell components like the Golgi apparatus and the nucleus, but those are already working well and won't change in this simulation.<br><br><a href='javascript:intro6()'>Continue</a>",mouthScaleTween.repeat(0),mouthPosTween.repeat(0),prvwTail.animations.paused=!1}function intro6(){adaptationDiv.innerHTML="In the water, you'll encounter food (top) and parasites (bottom).<br><br>How much food you collect will affect how Zoe's species adapts and evolves over time. Avoid parasites - running into them will drop your health!<br><br>Once you run out of health or energy, your food-collecting round will end.<br><br><a href='javascript:intro7()'>Continue</a>",prvwProtozoa.x+=1e3,prvwFood=protozoaPreview.add.sprite(40,30,"food"),prvwParasite=protozoaPreview.add.sprite(40,130,"parasite","parasite1.png"),prvwParasite.scale.setTo(.3)}function intro7(){adaptationDiv.innerHTML="It's time to hunt for food! In your starting environment, there aren't any parasites to worry about, so focus on collecting food.<br><br>When the game starts, use the arrow keys to move. Collect as much food as you can before you run out of health or energy.<br><br><b>Hint:</b> Zoe hasn't evolved much in her current environment, so she probably won't be very good at collecting food yet.<br><br><a href='javascript:startGame()'>Start</a>","undefined"!=typeof prvwFood&&(prvwProtozoa.x-=1e3,prvwFood.destroy(),delete prvwFood,prvwParasite.destroy(),delete prvwParasite),game=new Phaser.Game(800,600,Phaser.AUTO,"gameDiv",{preload:phaserPreload,create:phaserCreate,update:phaserUpdate})}function startGame(){$("#mutationDiv").hide(),$("#gameDiv").show(),prvwProtozoa.x+=1e3,protozoaPreview.paused=!0,game.paused=!1}function highlightComponent(e,a){return[protozoaPreview.add.tween(e.scale).to({x:a*e.scale.x,y:a*e.scale.y},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),protozoaPreview.add.tween(e).to({x:e.x-e.width*(a-1)*.5,y:e.y-e.height*(a-1)*.5},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)]}var protozoaPreview=new Phaser.Game(200,600,Phaser.AUTO,"protozoaPreviewDiv",{preload:protozoaPreviewPreload,create:protozoaPreviewCreate});function protozoaPreviewPreload(){protozoaPreview.load.image("protozoaBody","images/protozoa/body.png"),protozoaPreview.load.image("mitochondria","images/protozoa/mitochondria.png"),protozoaPreview.load.atlasJSONArray("protozoaTail","images/protozoa/tail.png","images/protozoa/tail.json"),protozoaPreview.load.atlasJSONArray("protozoaMouth","images/protozoa/mouth.png","images/protozoa/mouth.json"),protozoaPreview.load.atlasJSONArray("protozoaCilia","images/protozoa/cilia.png","images/protozoa/cilia.json"),protozoaPreview.load.atlasJSONArray("protozoaWall","images/protozoa/wall.png","images/protozoa/wall.json"),protozoaPreview.load.image("food","images/protozoa/food.png"),protozoaPreview.load.atlasJSONArray("parasite","images/protozoa/parasite.png","images/protozoa/parasite.json"),protozoaPreview.load.image("current","images/protozoa/current.jpg")}function createMitochondria(e){"undefined"!=typeof prvwMitochondria&&(prvwMitochondria.destroy(),delete prvwMitochondria),prvwMitochondria=protozoaPreview.add.sprite(50*(1-e)-10,0,"mitochondria"),prvwMitochondria.scale.setTo(e),prvwProtozoa.addChild(prvwMitochondria)}function createWall(e,a,i){"undefined"!=typeof prvwWall&&(prvwWall.destroy(),delete prvwWall),prvwWall=protozoaPreview.add.sprite(-95,-195,"protozoaWall","wall_"+e+".png"),prvwProtozoa.addChild(prvwWall),createTail(a,i)}function createTail(e,a){"undefined"!=typeof prvwTail&&(prvwTail.destroy(),delete prvwTail),prvwTail=protozoaPreview.add.sprite(-50,140+40*(1-e),"protozoaTail"),prvwTail.scale.setTo(1,e),prvwTail.animations.add("pTailSwing",[0,1,2,3,4,5,6,5,4,3,2,1]),prvwTail.animations.play("pTailSwing",30,!0),prvwTail.animations.paused=a,prvwProtozoa.addChild(prvwTail)}function createMouth(e){"undefined"!=typeof prvwMouth&&(prvwMouth.destroy(),delete prvwMouth),prvwMouth=protozoaPreview.add.sprite(-40-4*e,-197,"protozoaMouth","mouth_0"+e+".png"),prvwProtozoa.addChild(prvwMouth)}function createCilia(e){if("undefined"!=typeof prvwCilia&&(prvwCilia.destroy(),delete prvwCilia),0!=e){switch(prvwCilia=protozoaPreview.add.sprite(-125,-225,"protozoaCilia"),e){case 1:prvwCilia.animations.add("pCiliaSwing",[0,1,2,3,4,3,2,1]);break;case 3:prvwCilia.animations.add("pCiliaSwing",[5,6,7,8,9,8,7,6]);break;case 2:prvwCilia.animations.add("pCiliaSwing",[10,11,12,13,14,13,12,11])}prvwCilia.animations.play("pCiliaSwing",20,!0),prvwProtozoa.addChild(prvwCilia)}}function protozoaPreviewCreate(){protozoaSize=.5,protozoaPreview.stage.backgroundColor="#ffffff",prvwProtozoa=protozoaPreview.add.sprite(60,120,"protozoaBody"),prvwProtozoa.anchor.set(.5),createMitochondria(pMitochondriaSize),createWall(pWallThickness,pTailLength,!1),createTail(pTailLength,!1),createMouth(pMouthNumber),0!=pCiliaNum&&createCilia(pCiliaNum),prvwProtozoa.scale.setTo(protozoaSize)}function populationCalc(cause,foodThisRound){game.paused=!0,protozoaPreview.paused=!1,$("#gameDiv").hide(),$("#mutationDiv").show(),adaptationDiv.innerHTML="energy"==cause?"You've run out of energy for this round.<br><br>":"You've run out of health for this round.<br><br>",adaptationDiv.innerHTML+="You collected "+foodThisRound+" pieces of food this round. In total, you've collected "+totalFood+" pieces of food. By better adapting to your environment, you'll be able to collect more!<br><br>","undefined"!=typeof adaptationObj&&("TRUE"==adaptationObj.keep&&eval(environmentNum)[adaptationObj.adaptation]?adaptationDiv.innerHTML+="The mutated offspring, who "+adaptationObj.impact+" than the rest of the species, were more fit as a result of their mutation. This adaptation will become the dominant phenotype until the next mutation.<br><br>":"FALSE"==adaptationObj.keep&&eval(environmentNum)[adaptationObj.adaptation]?(eval(adaptationObj.adaptation+"-="+adaptationObj.change),adaptationDiv.innerHTML+="The mutated offspring, who "+adaptationObj.impact+" than the rest of the species, were less fit as a result of their mutation. Organisms with this mutation will quickly die out due to competition with the rest of their species.<br><br>"):(eval(adaptationObj.adaptation+"-="+adaptationObj.change),adaptationDiv.innerHTML+="The mutated offspring, who "+adaptationObj.impact+" than the rest of the species, were no more or less fit in this specific environment. Having no advantage over the rest of the species, these mutated organisms slowly die out.<br><br>")),65e4==years[years.length-1]?adaptationDiv.innerHTML+="<b>Say goodbye to Zoe's species</b>, because we're about to travel a billion years into the future. Don't expect to recognize her anymore!<br><br><a href='javascript:switchSpecies()'>To the future!</a>":adaptationDiv.innerHTML+="Let's fast forward fifty thousand years and see how Zoe's species has changed.<br><br><a href='javascript:populationCalc2("+foodThisRound+")'>To the future!</a>"}function populationCalc2(e){switch($("#yearPopDiv").show(),newYear=years[years.length-1]+5e4,years.push(newYear),preMutate(),adaptationDiv.innerHTML="It's now the year "+addCommas(newYear)+".<br><br>",newYear){case 3e5:environmentNum="environment2",adaptationDiv.innerHTML+="Over the past 50,000 years, <b>Zoe's species has migrated to a new environment</b>. In this environment, they face a dangerous new enemy - parasites - which can be seen to the left.<br><br>",prvwProtozoa.x+=1e3,prvwParasite=protozoaPreview.add.sprite(40,30,"parasite","parasite1.png"),prvwParasite2=protozoaPreview.add.sprite(40,130,"parasite","parasite2.png"),prvwParasite.scale.setTo(.3),prvwParasite2.scale.setTo(.3);break;case 5e5:environmentNum="environment3",adaptationDiv.innerHTML+="Over the past 50,000 years, <b>Zoe's species has migrated to a new environment</b>. In this environment, the river has a strong current which Zoe's species will need to swim against in order to reach food. <br><br>",prvwProtozoa.x+=1e3,prvwCurrent=protozoaPreview.add.sprite(40,0,"current"),prvwCurrent.scale.setTo(.6)}adaptationDiv.innerHTML+="Based on your food-collecting performance, and a simulation of the rest of Zoe's species over the past fifty thousand years, Zoe's species has ",oldPop=pops[pops.length-1];var a=calculatePopulationChange()+e/5;newPop=Math.ceil(oldPop*(100+a)/100),pops.push(newPop);var i={labels:years,series:[pops]};popChart=new Chartist.Line("#yearPopDiv",i,{width:400,height:200,showArea:!0,axisY:{onlyInteger:!0},axisX:{showLabel:!1,showGrid:!1}}),newPop<oldPop?adaptationDiv.innerHTML+="shrunk to "+newPop+". Looks like they'd better get adapting quickly, before they go extinct!<br><br><a href='javascript:mutate()'>Let's scramble some DNA</a><br><br>":newPop>oldPop?adaptationDiv.innerHTML+="grown to "+newPop+". That's decent growth, but they can grow even faster with the right adaptations!<br><br><a href='javascript:mutate()'>Let's scramble some DNA</a><br><br>":adaptationDiv.innerHTML+="maintained its population of "+newPop+". With the right adaptations, this population is ready to grow!<br><br><a href='javascript:mutate()'>Let's scramble some DNA</a><br><br>"}function calculatePopulationChange(){switch(environmentNum){case"environment1":var e=7*(pTailLength-.4)+12*(pMitochondriaSize-.6)+3*(pMouthNumber-2)+4*pCiliaNum;break;case"environment2":e=7*(pTailLength-.3)+6*(pMitochondriaSize-.5)+2*(pMouthNumber-1)+4*pCiliaNum+6*(pWallThickness-3);break;case"environment3":e=20*(pTailLength-.3)+6*(pMitochondriaSize-.5)+2*(pMouthNumber-1)+4*pCiliaNum+4*(pWallThickness-3);break;case"environment4":e=10*(bWingSize-.7)+10*(bTailSize-.8)+10*(bBeakSize-1)+2*(bEyeSize-.7);break;case"environment5":e=8*(bWingSize-.7)+15*(bTailSize-.8)+8*(bBeakSize-1)+6*(bEyeSize-.7);break;case"environment6":e=8*(bWingSize-.7)+12*(bTailSize-.8)+15*(bBeakSize-1)+20*(bEyeSize-.7)}return e}function preMutate(){switch("undefined"!=typeof adaptationObj&&"FALSE"==adaptationObj.keep&&eval(adaptationObj.adaptation+"-="+adaptationObj.change),newYear){case 15e4:adaptationObj=[],adaptationObj.adaptation="pCiliaNum",adaptationObj.impact="turn faster",adaptationObj.keep="TRUE",pCiliaNum=1,mutationHtml="An entirely new organelle is found in the mutated offspring - cilia. These small hair-like structures give the organisms better control of their movement, allowing them to turn faster while hunting food.<br><br>Let's see how much these early cilia help!<br><br><a href='javascript:startGame()'>Start</a>";break;default:for(var goodAdaptation=!1;0==goodAdaptation;)if(adaptationObj=adaptationsObjArray[Math.floor(Math.random()*adaptationsObjArray.length)],("cilia grows more dense"!=adaptationObj.description||0!=pCiliaNum)&&eval(adaptationObj.adaptation+adaptationObj.condition)){goodAdaptation=!0;break}eval(adaptationObj.adaptation+"+="+adaptationObj.change),mutationHtml="In the newly mutated offspring, the "+adaptationObj.description+", causing these organisms to "+adaptationObj.impact+".<br><br>Let's see how they do in their hunt for food.<br><br><a href='javascript:startGame()'>Start</a>"}game.paused=!1,game.state.restart()}function mutate(){switch($("#yearPopDiv").hide(),prvwTail.animations.paused=!0,"undefined"!=typeof prvwCilia&&(prvwCilia.animations.paused=!0),newYear){case 3e5:prvwProtozoa.x-=1e3,prvwParasite.destroy(),delete prvwParasite,prvwParasite2.destroy(),delete prvwParasite2;break;case 5e5:prvwProtozoa.x-=1e3,prvwCurrent.destroy(),delete prvwCurrent}switch(adaptationDiv.innerHTML="In the year "+addCommas(newYear)+", a mutation is introduced into Zoe's species.<br><br>",adaptationObj.adaptation){case"pTailLength":createTail(pTailLength,!1);break;case"pMitochondriaSize":createMitochondria(pMitochondriaSize),highlightComponent(prvwMitochondria,4.3-4*pMitochondriaSize);break;case"pMouthNumber":createMouth(pMouthNumber),highlightComponent(prvwMouth,1.4);break;case"pWallThickness":createWall(pWallThickness,pTailLength,!0),highlightComponent(prvwWall,1.1);break;case"pCiliaNum":createCilia(pCiliaNum)}adaptationDiv.innerHTML+=mutationHtml}function phaserPreload(){game.load.image("protozoaBody","images/protozoa/body.png"),game.load.image("mitochondria","images/protozoa/mitochondria.png"),game.load.image("oceanBackground","images/ocean_background.jpg"),game.load.image("bubble","images/protozoa/bubble.png"),game.load.image("food","images/protozoa/food.png"),game.load.atlasJSONArray("protozoaTail","images/protozoa/tail.png","images/protozoa/tail.json"),game.load.atlasJSONArray("protozoaMouth","images/protozoa/mouth.png","images/protozoa/mouth.json"),game.load.atlasJSONArray("protozoaCilia","images/protozoa/cilia.png","images/protozoa/cilia.json"),game.load.atlasJSONArray("protozoaWall","images/protozoa/wall.png","images/protozoa/wall.json"),game.load.atlasJSONArray("parasite","images/protozoa/parasite.png","images/protozoa/parasite.json"),game.load.image("health","images/health.png"),game.load.image("energy","images/energy.png")}function phaserCreate(){if(protozoaSize=.2,maxVelocity=10*pTailLength,thrustAmt=330+70*pTailLength,rotationSpeed=20*(1.3+pCiliaNum),energy=5e4*pMitochondriaSize,damagePerCollision=-4*Math.log(pWallThickness)+10,game.add.image(0,0,"oceanBackground"),game.physics.startSystem(Phaser.Physics.P2JS),game.physics.p2.setImpactEvents(!0),protozoa=game.add.sprite(400,300,"protozoaBody"),pMitochondria=game.add.sprite(50*(1-pMitochondriaSize)-10,0,"mitochondria"),pWall=game.add.sprite(-95,-195,"protozoaWall","wall_"+pWallThickness+".png"),pTail=game.add.sprite(-50,140+40*(1-pTailLength),"protozoaTail"),pTail.scale.setTo(1,pTailLength),pTail.animations.add("pTailSwing",[0,1,2,3,4,5,6,5,4,3,2,1]),pTail.animations.play("pTailSwing",40,!0),pTail.animations.paused=!0,pMouth=game.add.sprite(400,268,"protozoaMouth","mouth_0"+pMouthNumber+".png"),0!=pCiliaNum){switch(pCilia=game.add.sprite(-125,-225,"protozoaCilia"),pCiliaNum){case 1:pCilia.animations.add("pCiliaSwing",[0,1,2,3,4,3,2,1]);break;case 3:pCilia.animations.add("pCiliaSwing",[5,6,7,8,9,8,7,6]);break;case 2:pCilia.animations.add("pCiliaSwing",[10,11,12,13,14,13,12,11])}pCilia.animations.play("pCiliaSwing",20,!0),pCilia.animations.paused=!0}protozoa.scale.setTo(protozoaSize),pMitochondria.scale.setTo(pMitochondriaSize),pMouth.scale.setTo(protozoaSize),game.physics.p2.restitution=.5,game.physics.p2.enable(protozoa,!1),game.physics.p2.enable(pMouth,!1),pMouthNumber>1&&pMouth.body.addRectangle(20*pMouthNumber,10*pMouthNumber,0,-3*pMouthNumber);var e=game.physics.p2.createCollisionGroup(),a=game.physics.p2.createCollisionGroup(),i=game.physics.p2.createCollisionGroup(),t=game.physics.p2.createCollisionGroup(),o=game.physics.p2.createCollisionGroup();game.physics.p2.updateBoundsCollisionGroup(),pMouth.body.setCollisionGroup(a),protozoa.body.setCollisionGroup(e),protozoa.body.collides(o,parasiteAttack,this),protozoa.addChild(pWall),protozoa.addChild(pMitochondria),protozoa.addChild(pTail),0!=pCiliaNum&&protozoa.addChild(pCilia);game.physics.p2.createLockConstraint(protozoa,pMouth,[0,36-2*pMouthNumber],0);protozoa.body.damping=.7,cursors=game.input.keyboard.createCursorKeys();for(var r=0,n=0;n<20;n++){var d=game.add.sprite(-100+game.world.randomX,700,"bubble");d.scale.set(game.rnd.realInRange(.05,.3));var s=game.rnd.between(1e4,13e3);game.add.tween(d).to({y:-100},s,Phaser.Easing.Sinusoidal.InOut,!0,r,-1,!1),r+=1e4}for(n=0;n<50;n++){Math.random()>=.5?(foodStart=game.rnd.between(-800,-50),foodVelocityX=game.rnd.between(25,100)):(foodStart=game.rnd.between(850,1600),foodVelocityX=game.rnd.between(-100,-25));var l=game.add.sprite(foodStart,game.world.randomY,"food");l.scale.set(game.rnd.realInRange(.2,.4)),game.physics.p2.enable(l,!1),l.body.collideWorldBounds=!1,l.body.setCollisionGroup(i),l.body.collides([a,t]),l.body.velocity.x=foodVelocityX,l.body.velocity.y=game.rnd.between(-40,40),l.body.damping=0,l.body.mass=1e-4,l.body.fixedRotation=!0,l.body.beingEaten=!1}pMouth.body.collides(i,eatFood,this);var b=game.physics.p2.createBody(400,300,0,!0);b.addRectangle(2800,10,0,-800),b.addRectangle(2800,10,0,800),b.addRectangle(10,1600,-1400,0),b.addRectangle(10,1600,1400,0),b.collideWorldBounds=!1,b.setCollisionGroup(t),b.collides(i,foodOutsideBounds,this),b.collides(o,parasiteOutsideBounds,this),parasiteCount="environment1"==environmentNum?0:10;for(n=0;n<parasiteCount;n++){Math.random()>=.5?(parasiteStart=game.rnd.between(-800,-50),parasiteVelocityX=game.rnd.between(50,200)):(parasiteStart=game.rnd.between(850,1600),parasiteVelocityX=game.rnd.between(-200,-50));var p=game.add.sprite(parasiteStart,game.world.randomY,"parasite","parasite"+game.rnd.between(1,4)+".png");parasiteScale=game.rnd.realInRange(.1,.2),p.scale.set(parasiteScale),game.physics.p2.enable(p,!1),p.body.collideWorldBounds=!1,p.body.setCollisionGroup(o),p.body.collides([e,t]),p.body.velocity.x=parasiteVelocityX,p.body.velocity.y=game.rnd.between(-40,40),p.body.damping=0,p.body.mass=50*parasiteScale,p.body.rotateRight(game.rnd.between(-30,30))}protozoa.health=100;healthBar=new HealthBar(this.game,{x:70,y:30,width:100,height:20,bg:{color:"#961517"},bar:{color:"#ed2024"},animationDuration:100}),healthIcon=game.add.image(10,10,"health"),healthIcon.scale.setTo(.3);energyBar=new HealthBar(this.game,{x:70,y:70,width:100,height:20,bg:{color:"#8e8d54"},bar:{color:"#fffc00"},animationDuration:1}),energyIcon=game.add.image(7,50,"energy"),energyIcon.scale.setTo(.4),gameTimer=game.time.create(!1),gameTimer.add(energy,outOfEnergy,this),gameTimer.start(),foodTextStyle={font:"bold 20px 'Palatino Linotype', 'Book Antiqua', Palatino, serif"},foodCollected=0,foodText=game.add.text(600,30,"Food collected: 0",foodTextStyle),game.paused=!0}function resetFood(e){Math.random()>=.5?(e.x=game.rnd.between(-800,-50),e.velocity.x=game.rnd.between(25,100)):(e.x=game.rnd.between(850,1600),e.velocity.x=game.rnd.between(-100,-25)),e.y=game.world.randomY,e.velocity.y=game.rnd.between(-40,40),e.beingEaten=!1}function eatFood(e,a){if(!a.beingEaten){a.beingEaten=!0,foodCollected+=1,foodText.text="Food collected: "+foodCollected;var i=game.physics.p2.createLockConstraint(e,a);game.add.tween(a.sprite.scale).to({x:0,y:0},250,null,!0,0,0,!0);setTimeout(function(){game.physics.p2.removeConstraint(i),resetFood(a)},250)}}function resetParasite(e){Math.random()>=.5?(e.x=game.rnd.between(-800,-50),parasiteVelocityX=game.rnd.between(25,100)):(e.x=game.rnd.between(850,1600),parasiteVelocityX=game.rnd.between(-100,-25)),e.velocity.x=parasiteVelocityX,e.velocity.y=game.rnd.between(-40,40),e.rotateRight(game.rnd.between(-30,30))}function parasiteAttack(){protozoa.health-=damagePerCollision,healthBar.setPercent(protozoa.health),protozoa.health<1&&outOfHealth()}function foodOutsideBounds(e,a){resetFood(a)}function parasiteOutsideBounds(e,a){resetParasite(a)}function outOfEnergy(){protozoaPreview.state.restart(),totalFood+=foodCollected,populationCalc("energy",foodCollected)}function outOfHealth(){protozoaPreview.state.restart(),totalFood+=foodCollected,populationCalc("health",foodCollected)}function phaserUpdate(){speed=protozoa.body.data.velocity[0]^2+protozoa.body.data.velocity[1]^2,"environment3"==environmentNum&&(protozoa.body.velocity.x-=3),turning=!1,cursors.left.isDown?(turning=!0,protozoa.body.rotateLeft(rotationSpeed),0!=pCiliaNum&&1==pCilia.animations.paused&&(pCilia.animations.paused=!1)):cursors.right.isDown?(turning=!0,protozoa.body.rotateRight(rotationSpeed),0!=pCiliaNum&&1==pCilia.animations.paused&&(pCilia.animations.paused=!1)):protozoa.body.setZeroRotation(),cursors.up.isDown?(protozoa.body.thrust(thrustAmt),1==pTail.animations.paused&&(pTail.animations.paused=!1,0!=pCiliaNum&&(pCilia.animations.paused=!1))):cursors.down.isDown?(protozoa.body.reverse(thrustAmt),1==pTail.animations.paused&&(pTail.animations.paused=!1,0!=pCiliaNum&&(pCilia.animations.paused=!1))):(pTail.animations.paused=!0,0==turning&&0!=pCiliaNum&&(pCilia.animations.paused=!0)),constrainVelocity(protozoa,maxVelocity),energyBar.setPercent(100*gameTimer.duration/energy)}function switchSpecies(){birdPreview=new Phaser.Game(200,600,Phaser.AUTO,"birdPreviewDiv",{preload:birdPreviewPreload,create:birdPreviewCreate}),$("#mutationDiv").hide(),$("#gameDiv").hide(),$("#birdMutationDiv").show(),"undefined"!=typeof game&&(game.destroy(),protozoaPreview.destroy()),environmentNum="environment4",years=[1e9],birdPops=[100*pops[pops.length-1]]}function birdIntro1(){$("#birdPreviewDiv").show(),birdAdaptationDiv.innerHTML="This is Berta. She's a member of the new species that came from Zoe's species. Let's take a look at the components that make up Berta.<br><br>First off, her wings. The larger her wings grow, the easier it'll be for Berta to stay up in the air.<br><br><a href='javascript:birdIntro2()'>Continue</a>","undefined"!=typeof birdPrvwTail&&(birdPrvwTail.animations.paused=!0)}function birdIntro2(){birdAdaptationDiv.innerHTML="This is Berta's tail. Her tail helps her fly forwards. The larger her tail grows, the faster she'll be able to fly side to side.<br><br><a href='javascript:birdIntro3()'>Continue</a>",birdPrvwWing.animations._anims.bWingFlap.loop=!1,birdPrvwTail.animations.paused=!1}function birdIntro3(){birdAdaptationDiv.innerHTML="Berta's beak is a lot like Zoe's cytostome (mouth). The larger her beak, the easier it'll be for her to catch nearby food!<br><br><a href='javascript:birdIntro4()'>Continue</a>",birdPrvwTail.animations.paused=!0,birdBeakScaleTween=birdPreview.add.tween(birdPrvwBeak.scale).to({x:1.5*birdPrvwBeak.scale.x,y:1.5*birdPrvwBeak.scale.y},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)}function birdIntro4(){birdAdaptationDiv.innerHTML="Berta doesn't have any real protection from enemies once they catch her, but by changing color to  match her environment, she's able to hide from them. In this simulation, Berta's species may evolve to better match the color of the sky.<br><br><a href='javascript:birdIntro5()'>Continue</a>",birdBeakScaleTween.repeat(0),birdColorTween=tweenTint(birdPrvwBird,16777215,7391231,500),birdTailColorTween=tweenTint(birdPrvwTail,16777215,7391231,500),birdWingColorTween=tweenTint(birdPrvwWing,16777215,7391231,500)}function birdIntro5(){birdAdaptationDiv.innerHTML="Finally, Berta needs to be able to see at night, as well as during the day. You'll start by hunting with her during the day, but as the light fades, her eyes will need to grow to find food and avoid enemies once the sun goes down.<br><br><a href='javascript:birdIntro6()'>Continue</a>",birdColorTween.repeat(0),birdTailColorTween.repeat(0),birdWingColorTween.repeat(0),birdEyeScaleTween=birdPreview.add.tween(birdPrvwEye.scale).to({x:2*birdPrvwEye.scale.x,y:2*birdPrvwEye.scale.y},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),birdEyePosTween=birdPreview.add.tween(birdPrvwEye).to({x:birdPrvwEye.x-1*birdPrvwEye.width*.5,y:birdPrvwEye.y-1*birdPrvwEye.height*.5},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)}function birdIntro6(){birdAdaptationDiv.innerHTML="In the air, you'll encounter ladybugs (top) and crows (bottom).<br><br>How many ladybugs you eat will affect how Berta's species adapts and evolves over time. Avoid crows - running into them will drop your health!<br><br>As before, once you run out of health or energy, your food-collecting round will end.<br><br><a href='javascript:birdIntro7()'>Continue</a>",birdEyeScaleTween.repeat(0),birdEyePosTween.repeat(0),birdPrvwBird.x+=1e3,birdPrvwLadybug=birdPreview.add.sprite(40,30,"ladybug"),birdPrvwCrow=birdPreview.add.sprite(30,130,"crow"),birdPrvwLadybug.scale.setTo(.5),birdPrvwCrow.scale.setTo(.3)}function birdIntro7(){birdAdaptationDiv.innerHTML="It's time to fly! In your starting environment, there aren't any crows to worry about, so focus on collecting ladybugs.<br><br>Use the up arrow to flap, and the left and right arrows to fly in each direction. Catch as many ladybugs as you can before you run out of health or energy.<br><br>Hint: Berta is the product of millions of years of evolution, but her species is still pretty new to flying, so she probably won't be very good at hunting ladybugs yet.<br><br><a href='javascript:startBirdGame()'>Start</a>",birdPrvwWing.animations._anims.bWingFlap.isPlaying=!0,birdPrvwWing.animations._anims.bWingFlap.loop=!0,birdPrvwTail.animations.paused=!1,"undefined"!=typeof birdPrvwLadybug&&(birdPrvwBird.x-=1e3,birdPrvwLadybug.destroy(),delete birdPrvwLadybug,birdPrvwCrow.destroy(),delete birdPrvwCrow),birdGame=new Phaser.Game(800,600,Phaser.AUTO,"birdGameDiv",{preload:birdPreload,create:birdCreate,update:birdUpdate})}function startBirdGame(){$("#birdMutationDiv").hide(),$("#birdGameDiv").show(),birdGame.paused=!1,birdPreview.paused=!0}function birdPreviewPreload(){birdPreview.load.image("birdBody","images/bird/body.png"),birdPreview.load.image("birdEye","images/bird/eye.png"),birdPreview.load.atlasJSONArray("birdTail","images/bird/tail.png","images/bird/tail.json"),birdPreview.load.atlasJSONArray("birdBeak","images/bird/beak.png","images/bird/beak.json"),birdPreview.load.atlasJSONArray("birdWing","images/bird/wing.png","images/bird/wing.json"),birdPreview.load.atlasJSONArray("ladybug","images/bird/ladybug.png","images/bird/ladybug.json"),birdPreview.load.image("crow","images/bird/crow.png")}function birdCreateWing(e){"undefined"!=typeof birdPrvwWing&&(birdPrvwWing.destroy(),delete birdPrvwWing),birdPrvwWing=birdPreview.add.sprite(-60*e,-330*e,"birdWing"),birdPrvwWing.scale.setTo(e),birdPrvwWing.animations.add("bWingFlap",[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1]),birdPrvwWing.animations.play("bWingFlap",40,!0),birdPrvwBird.addChild(birdPrvwWing)}function birdCreateTail(e){"undefined"!=typeof birdPrvwTail&&(birdPrvwTail.destroy(),delete birdPrvwTail),birdPrvwTail=birdPreview.add.sprite(10*e-230,65*e-80,"birdTail"),birdPrvwTail.anchor.set(.92,.9),birdPrvwTail.scale.setTo(e),birdPrvwTail.animations.add("bTailFlap",[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1]),birdPrvwTail.animations.play("bTailFlap",40,!0),birdPrvwBird.addChild(birdPrvwTail)}function birdCreateBeak(e){"undefined"!=typeof birdPrvwBeak&&(birdPrvwBeak.destroy(),delete birdPrvwBeak),birdPrvwBeak=birdPreview.add.sprite(242,-83,"birdBeak"),birdPrvwBeak.anchor.set(0,.57),birdPrvwBeak.scale.setTo(e,.5+e/6),birdPrvwBird.addChild(birdPrvwBeak)}function birdCreateEye(e){"undefined"!=typeof birdPrvwEye&&(birdPrvwEye.destroy(),delete birdPrvwEye),birdPrvwEye=birdPreview.add.sprite(180-45*e,-150-5*e,"birdEye"),birdPrvwEye.scale.setTo(e),birdPrvwBird.addChild(birdPrvwEye)}function birdPreviewCreate(){birdSize=.25,birdPreview.stage.backgroundColor="#ffffff",birdPrvwBird=birdPreview.add.sprite(110,120,"birdBody"),birdPrvwBird.anchor.set(.5),birdCreateTail(bTailSize),birdCreateBeak(bBeakSize),birdCreateEye(bEyeSize),birdCreateWing(bWingSize),birdPrvwTint=Phaser.Color.interpolateColor(16777215,7391231,100,bBlueness),birdPrvwWing.tint=birdPrvwTint,birdPrvwTail.tint=birdPrvwTint,birdPrvwBird.tint=birdPrvwTint,birdPrvwBird.scale.setTo(birdSize)}function birdPopulationCalc(cause,foodThisRound){birdGame.paused=!0,birdPreview.paused=!1,$("#birdGameDiv").hide(),$("#birdMutationDiv").show(),birdAdaptationDiv.innerHTML="energy"==cause?"You've run out of energy for this round.<br><br>":"You've run out of health for this round.<br><br>",birdAdaptationDiv.innerHTML+="You collected "+foodThisRound+" ladybugs this round. In total, you've collected "+totalFood+" pieces of food. By better adapting to your environment, you'll be able to collect more!<br><br>","undefined"!=typeof birdAdaptationObj&&("TRUE"==birdAdaptationObj.keep&&eval(environmentNum)[birdAdaptationObj.adaptation]?birdAdaptationDiv.innerHTML+="The mutated offspring, who "+birdAdaptationObj.impact+" than the rest of the species, were more fit as a result of their mutation. This adaptation will become the dominant phenotype until the next mutation.<br><br>":"FALSE"==birdAdaptationObj.keep&&eval(environmentNum)[birdAdaptationObj.adaptation]?(eval(birdAdaptationObj.adaptation+"-="+birdAdaptationObj.change),birdAdaptationDiv.innerHTML+="The mutated offspring, who "+birdAdaptationObj.impact+" than the rest of the species, were less fit as a result of their mutation. Organisms with this mutation will quickly die out due to competition with the rest of their species.<br><br>"):(eval(birdAdaptationObj.adaptation+"-="+birdAdaptationObj.change),birdAdaptationDiv.innerHTML+="The mutated offspring, who "+birdAdaptationObj.impact+" than the rest of the species, were no more or less fit in this specific environment. Having no advantage over the rest of the species, these mutated organisms slowly die out.<br><br>")),birdAdaptationDiv.innerHTML+="Let's fast forward fifty thousand years and see how Berta's species has changed.<br><br><a href='javascript:birdPopulationCalc2("+foodThisRound+")'>To the future!</a>"}function birdPopulationCalc2(e){switch($("#birdYearPopDiv").show(),newYear=years[years.length-1]+5e4,years.push(newYear),birdPreMutate(),birdAdaptationDiv.innerHTML="It's now the year "+addCommas(newYear)+".<br><br>",newYear){case 10002e5:environmentNum="environment5",birdAdaptationDiv.innerHTML+="Over the past 50,000 years, <b>Zoe's species has migrated to a new environment</b>. In this environment, they face a dangerous new enemy - crows - which can be seen to the left.<br><br>",birdPrvwBird.x+=1e3,birdPrvwCrow=birdPreview.add.sprite(30,130,"crow"),birdPrvwCrow.scale.setTo(.3);break;case 10004e5:environmentNum="environment6",birdAdaptationDiv.innerHTML+="Over the past 50,000 years, <b>Zoe's species has migrated to a new environment</b>. In this environment, they are forced to hunt at night, making it more challenging to see both ladybugs and crows.<br><br>"}birdAdaptationDiv.innerHTML+="Based on your food-collecting performance, and a simulation of the rest of Berta's species over the past fifty thousand years, Berta's species has ",oldPop=birdPops[birdPops.length-1];var a=calculatePopulationChange()+e/5;newPop=Math.ceil(oldPop*(100+a)/100),birdPops.push(newPop);var i={labels:years,series:[birdPops]};popChart=new Chartist.Line("#birdYearPopDiv",i,{width:400,height:200,showArea:!0,axisY:{onlyInteger:!0},axisX:{showLabel:!1,showGrid:!1}}),newPop<oldPop?birdAdaptationDiv.innerHTML+="shrunk to "+addCommas(newPop)+". Looks like they'd better get adapting quickly, before they go extinct!<br><br><a href='javascript:birdMutate()'>Let's scramble some DNA</a><br><br>":newPop>oldPop?birdAdaptationDiv.innerHTML+="grown to "+addCommas(newPop)+". That's decent growth, but they can grow even faster with the right adaptations!<br><br><a href='javascript:birdMutate()'>Let's scramble some DNA</a><br><br>":birdAdaptationDiv.innerHTML+="maintained its population of "+addCommas(newPop)+". With the right adaptations, this population is ready to grow!<br><br><a href='javascript:birdMutate()'>Let's scramble some DNA</a><br><br>"}function birdPreMutate(){"undefined"!=typeof birdAdaptationObj&&"FALSE"==birdAdaptationObj.keep&&eval(birdAdaptationObj.adaptation+"-="+birdAdaptationObj.change);for(var goodAdaptation=!1;0==goodAdaptation;)birdAdaptationObj=birdAdaptationsObjArray[Math.floor(Math.random()*birdAdaptationsObjArray.length)],eval(birdAdaptationObj.adaptation+birdAdaptationObj.condition)&&(goodAdaptation=!0);eval(birdAdaptationObj.adaptation+"+="+birdAdaptationObj.change),birdMutationHtml="In the newly mutated offspring, the "+birdAdaptationObj.description+", causing these organisms to "+birdAdaptationObj.impact+".<br><br>Let's see how they do in their hunt for ladybugs.<br><br><a href='javascript:startBirdGame()'>Start</a>",birdGame.paused=!1,birdGame.state.restart()}function birdMutate(){switch($("#birdYearPopDiv").hide(),birdPrvwWing.animations._anims.bWingFlap.loop=!1,birdPrvwTail.animations.paused=!0,newYear){case 10002e5:birdPrvwBird.x-=1e3,birdPrvwCrow.destroy(),delete birdPrvwCrow}switch(birdAdaptationDiv.innerHTML="In the year "+addCommas(newYear)+", a mutation is introduced into Berta's species.<br><br>",birdAdaptationObj.adaptation){case"bWingSize":birdCreateWing(bWingSize),birdPrvwWing.animations._anims.bWingFlap.isPlaying=!0,birdPrvwWing.animations._anims.bWingFlap.loop=!0;break;case"bTailSize":birdCreateTail(bTailSize),birdPrvwTail.animations.paused=!1;break;case"bEyeSize":birdCreateEye(bEyeSize),birdPreview.add.tween(birdPrvwEye.scale).to({x:2*birdPrvwEye.scale.x,y:2*birdPrvwEye.scale.y},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),birdPreview.add.tween(birdPrvwEye).to({x:birdPrvwEye.x-1*birdPrvwEye.width*.5,y:birdPrvwEye.y-1*birdPrvwEye.height*.5},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0);break;case"bBeakSize":birdCreateBeak(bBeakSize),birdPreview.add.tween(birdPrvwBeak.scale).to({x:1.5*birdPrvwBeak.scale.x,y:1.5*birdPrvwBeak.scale.y},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0);break;case"bBlueness":birdColorTween=tweenTint(birdPrvwBird,16777215,7391231,500),birdTailColorTween=tweenTint(birdPrvwTail,16777215,7391231,500),birdWingColorTween=tweenTint(birdPrvwWing,16777215,7391231,500)}birdAdaptationDiv.innerHTML+=birdMutationHtml}function birdPreload(){birdGame.load.image("birdBody","images/bird/body.png"),birdGame.load.image("birdEye","images/bird/eye.png"),birdGame.load.image("skyBackground","images/skyBackground.jpg"),birdGame.load.atlasJSONArray("birdTail","images/bird/tail.png","images/bird/tail.json"),birdGame.load.atlasJSONArray("birdBeak","images/bird/beak.png","images/bird/beak.json"),birdGame.load.atlasJSONArray("birdWing","images/bird/wing.png","images/bird/wing.json"),birdGame.load.image("health","images/health.png"),birdGame.load.image("energy","images/energy.png"),birdGame.load.atlasJSONArray("ladybug","images/bird/ladybug.png","images/bird/ladybug.json"),birdGame.load.image("crow","images/bird/crow.png"),birdGame.load.image("night","images/bird/black.gif")}function birdCreate(){energy=2e4,bThrust=50+200*(bTailSize-.5),bLift=90+100*bWingSize,birdDamagePerCollision=8;var e=7+14*bBeakSize;birdGame.add.image(0,0,"skyBackground"),birdGame.physics.startSystem(Phaser.Physics.P2JS),birdGame.physics.p2.setImpactEvents(!0),bird=birdGame.add.sprite(400,300,"birdBody"),bEye=birdGame.add.sprite(180-45*bEyeSize,-150-5*bEyeSize,"birdEye"),bEye.scale.setTo(bEyeSize),bTail=birdGame.add.sprite(10*bTailSize-230,65*bTailSize-80,"birdTail"),bTail.anchor.set(.92,.9),bTail.scale.setTo(bTailSize),bTail.animations.add("bTailFlap",[0,1,2,3,4,5,6,5,4,3,2,1]),bTail.animations.play("bTailFlap",40,!0),bBeak=birdGame.add.sprite(242,-83,"birdBeak"),bBeak.anchor.set(0,.57),bBeak.scale.setTo(bBeakSize,.5+bBeakSize/6),bBeak.animations.add("bBeakEat",[0,1,2,3,2,1]),bWing=birdGame.add.sprite(-60*bWingSize,-330*bWingSize,"birdWing"),bWing.scale.setTo(bWingSize),bWing.animations.add("bWingFlap",[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1]),bWing.animations.play("bWingFlap",40,!0),bBeakBox=birdGame.physics.p2.createBody(440,300,0,!0),bBeakBox.addRectangle(e,e,0,0),bBeakBox.collideWorldBounds=!1,bBeakBox.debug=!1,birdScale=.15,bird.scale.setTo(birdScale),tintColor=Phaser.Color.interpolateColor(16777215,7391231,10,Math.round(Math.sqrt(bBlueness))),bird.tint=tintColor,bTail.tint=tintColor,bWing.tint=tintColor,birdGame.physics.p2.restitution=.1,birdGame.physics.p2.enable(bird,!1),birdGame.physics.p2.gravity.y=100,bird.body.fixedRotation=!0;var a=birdGame.physics.p2.createCollisionGroup(),i=birdGame.physics.p2.createCollisionGroup(),t=birdGame.physics.p2.createCollisionGroup(),o=birdGame.physics.p2.createCollisionGroup(),r=birdGame.physics.p2.createCollisionGroup();birdGame.physics.p2.updateBoundsCollisionGroup(),bBeakBox.setCollisionGroup(i),bird.body.setCollisionGroup(a),bird.body.collides(r,crowAttack,this),bird.addChild(bEye),bird.addChild(bBeak),bird.addChild(bWing),bird.addChild(bTail),bird.body.damping=.3,cursors=birdGame.input.keyboard.createCursorKeys();for(var n=0;n<50;n++){if(Math.random()>=.5){ladybugStart=birdGame.rnd.between(-800,-50),ladybugVelocityX=birdGame.rnd.between(50,150);var d=!0}else{ladybugStart=birdGame.rnd.between(850,1600),ladybugVelocityX=birdGame.rnd.between(-150,-50);d=!1}var s=birdGame.add.sprite(ladybugStart,birdGame.world.randomY,"ladybug");s.animations.add("lFly",[0,1,2,3,2,1]),s.animations.play("lFly",40,!0),s.scale.set(birdGame.rnd.realInRange(.1,.2)),birdGame.physics.p2.enable(s,!1),s.body.data.gravityScale=0,s.body.collideWorldBounds=!1,s.body.setCollisionGroup(t),s.body.collides([i,o]),s.body.velocity.x=ladybugVelocityX,s.body.velocity.y=birdGame.rnd.between(-40,40),s.body.damping=0,s.body.mass=1e-4,s.body.fixedRotation=!0,s.body.beingEaten=!1,d?(s.body.facingRight=!0,s.body.sprite.scale.x*=-1):s.body.facingRight=!1}bBeakBox.collides(t,eatLadybug,this);var l=birdGame.physics.p2.createBody(400,300,0,!0);l.addRectangle(2800,10,0,-800),l.addRectangle(2800,10,0,800),l.addRectangle(10,1600,-1400,0),l.addRectangle(10,1600,1400,0),l.collideWorldBounds=!1,l.setCollisionGroup(o),l.collides(t,ladybugOutsideBounds,this),l.collides(r,crowOutsideBounds,this),crowCount="environment4"==environmentNum?0:Math.ceil(8-8*bBlueness/100);for(n=0;n<crowCount;n++){if(Math.random()>=.5){crowStart=birdGame.rnd.between(-400,250),crowVelocityX=birdGame.rnd.between(100,250);d=!1}else{d=!0;crowStart=birdGame.rnd.between(550,1200),crowVelocityX=birdGame.rnd.between(-250,-100)}var b=birdGame.add.sprite(crowStart,birdGame.rnd.between(-600,-200),"crow");crowScale=birdGame.rnd.realInRange(.2,.3),b.scale.set(crowScale),birdGame.physics.p2.enable(b,!1),b.body.collideWorldBounds=!1,b.body.setCollisionGroup(r),b.body.collides([a,o]),b.body.velocity.x=crowVelocityX,b.body.velocity.y=birdGame.rnd.between(100,350),b.body.data.gravityScale=0,b.body.damping=0,b.body.mass=30*crowScale,b.body.fixedRotation=!0,d?(b.body.facingRight=!1,b.body.sprite.scale.x*=-1):b.body.facingRight=!0}direction="right",ladybugTextStyle={font:"bold 20px 'Palatino Linotype', 'Book Antiqua', Palatino, serif",fill:"black"},years[years.length-1]>100039e4&&(night=birdGame.add.sprite(0,0,"night"),night.scale.setTo(400),night.alpha=1-bEyeSize/2,night.alpha>.5&&(ladybugTextStyle={font:"bold 20px 'Palatino Linotype', 'Book Antiqua', Palatino, serif",fill:"white"})),bird.health=100;birdHealthBar=new HealthBar(this.game,{x:70,y:30,width:100,height:20,bg:{color:"#961517"},bar:{color:"#ed2024"},animationDuration:100}),birdHealthIcon=birdGame.add.image(10,10,"health"),birdHealthIcon.scale.setTo(.3);birdEnergyBar=new HealthBar(this.game,{x:70,y:70,width:100,height:20,bg:{color:"#8e8d54"},bar:{color:"#fffc00"},animationDuration:1}),birdEnergyIcon=birdGame.add.image(7,50,"energy"),birdEnergyIcon.scale.setTo(.4),birdGameTimer=birdGame.time.create(!1),birdGameTimer.add(energy,birdOutOfEnergy,this),birdGameTimer.start(),ladybugsCollected=0,ladybugText=birdGame.add.text(570,30,"Ladybugs collected: 0",ladybugTextStyle),birdGame.paused=!0}function eatLadybug(e,a){if(bBeak.animations.play("bBeakEat",20,!1),!a.beingEaten){a.beingEaten=!0,ladybugsCollected+=1,ladybugText.text="Ladybugs collected: "+ladybugsCollected;var i=birdGame.physics.p2.createLockConstraint(e,a);birdGame.add.tween(a.sprite.scale).to({x:0,y:0},250,null,!0,0,0,!1);setTimeout(function(){birdGame.physics.p2.removeConstraint(i),resetLadybug(a)},250)}}function ladybugOutsideBounds(e,a){resetLadybug(a)}function crowOutsideBounds(e,a){resetCrow(a)}function resetCrow(e){Math.random()>=.5?(e.x=birdGame.rnd.between(-400,250),e.velocity.x=birdGame.rnd.between(100,250),e.facingRight||(e.sprite.scale.x*=-1,e.facingRight=!0)):(e.x=birdGame.rnd.between(550,1200),e.velocity.x=birdGame.rnd.between(-250,-100),e.facingRight&&(e.sprite.scale.x*=-1,e.facingRight=!1)),e.y=birdGame.rnd.between(-600,-200),e.velocity.y=birdGame.rnd.between(200,500)}function resetLadybug(e){e.sprite.scale.set(birdGame.rnd.realInRange(.1,.2)),e.facingRight=!1,Math.random()>=.5?(e.x=birdGame.rnd.between(-800,-50),e.velocity.x=birdGame.rnd.between(50,150),e.facingRight||(e.sprite.scale.x*=-1,e.facingRight=!0)):(e.x=birdGame.rnd.between(850,1600),e.velocity.x=birdGame.rnd.between(-150,-50),e.facingRight&&(e.sprite.scale.x*=-1,e.facingRight=!1)),e.y=birdGame.world.randomY,e.velocity.y=birdGame.rnd.between(-40,40),e.beingEaten=!1}function crowAttack(){bird.health-=birdDamagePerCollision,birdHealthBar.setPercent(bird.health),bird.health<1&&birdOutOfHealth()}function birdOutOfHealth(){birdPreview.state.restart(),totalFood+=foodCollected,birdPopulationCalc("health",ladybugsCollected)}function birdOutOfEnergy(){birdPreview.state.restart(),totalFood+=foodCollected,birdPopulationCalc("energy",ladybugsCollected)}function birdUpdate(){"right"==direction?bBeakBox.x=bBeak.worldPosition.x+10:bBeakBox.x=bBeak.worldPosition.x-10,bBeakBox.y=bBeak.worldPosition.y,bBeakBox.debug&&("right"==direction?bBeakBox.debugBody.x=bBeak.worldPosition.x+10:bBeakBox.debugBody.x=bBeak.worldPosition.x-10,bBeakBox.debugBody.y=bBeak.worldPosition.y),cursors.left.isDown?(bird.body.thrustLeft(bThrust),"right"==direction&&(direction="left",bird.body.sprite.scale.x*=-1),1==bTail.animations.paused&&(bTail.animations.paused=!1)):cursors.right.isDown?(bird.body.thrustRight(bThrust),"left"==direction&&(direction="right",bird.body.sprite.scale.x*=-1),1==bTail.animations.paused&&(bTail.animations.paused=!1)):0!=bTail.animations.paused||cursors.up.isDown||(bTail.animations.paused=!0),cursors.up.isDown?(bird.body.thrust(bLift),1==bWing.animations.paused&&(bTail.animations.paused=!1,bWing.animations.paused=!1)):bWing.animations.paused=!0,birdEnergyBar.setPercent(100*birdGameTimer.duration/energy)}function constrainVelocity(e,a){var i,t,o,r=e.body;(t=r.data.velocity[0])*t+(o=r.data.velocity[1])*o>a*a&&(i=Math.atan2(o,t),t=Math.cos(i)*a,o=Math.sin(i)*a,r.data.velocity[0]=t,r.data.velocity[1]=o)}function addCommas(e){return(e+"").replace(/(\d)(?=(\d{3})+$)/g,"$1,")}function tweenTint(e,a,i,t){var o={step:0},r=birdPreview.add.tween(o).to({step:100},t,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0);return r.onUpdateCallback(function(){e.tint=Phaser.Color.interpolateColor(a,i,100,o.step)}),e.tint=a,r}