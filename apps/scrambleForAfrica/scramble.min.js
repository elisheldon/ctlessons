var myTeam=null,worldCode=null,squares=[],claimableSquares=[],year=0,nextUp="",years=[1500,1600,1700,1800,1815,1830,1845,1860,1875,1885,1895,1900],claims=0,turnCountdown=null,squaresThisTurn="",turnHistory="",claimableSecondAttempt=!1,firstLoad=!0,numTeams=0,tutorialMode=!1,timeLeft=0,teacherMode=!1,paused=!1;$(document).ready(function(){$.ajax({type:"GET",url:"mapData.csv",dataType:"text",success:function(e){mapDataArray=$.csv.toObjects(e),fillTable(),$.ajax({type:"GET",url:"mapDataTutorial.csv",dataType:"text",success:function(e){mapDataArrayTutorial=$.csv.toObjects(e),fillTableTutorial(),$(".tooltip").tooltipster({theme:"tooltipster-light",side:["left","right","top","bottom"],distance:-6,animationDuration:200,content:"Loading...",contentAsHTML:!0,interactive:!0,functionBefore:function(e,a){tutorialMode?e.content(createTooltipTutorial(a.origin.id.substring(23))):e.content(createTooltip(a.origin.id.substring(15)))}})}})}}),$.ajax({type:"GET",url:"teamData.csv",dataType:"text",success:function(e){teamDataArray=$.csv.toObjects(e)}})});var config={apiKey:"AIzaSyBEE-8nI0Z9kZIBYJejd0B5Y4tUaYo2dCU",authDomain:"scrambleforafrica-b6375.firebaseapp.com",databaseURL:"https://scrambleforafrica-b6375.firebaseio.com",projectId:"scrambleforafrica-b6375",storageBucket:"scrambleforafrica-b6375.appspot.com",messagingSenderId:"606539511518"};firebase.initializeApp(config);var db=firebase.database();function gameIntro(){var e=getParameterByName("world");null!=e?($("#loadingDiv").show(),db.ref("worlds/"+e).once("value").then(function(a){null!=a.val()?(numTeams=a.val().teams,worldCode=e,getTeam()):($("#enterWorldCode").show(),$("#loadingDiv").hide())})):$("#enterWorldCode").show()}function getTeam(){for(i=0;i<7-numTeams;i++)document.getElementById("teamSelect").remove(6-i);"teacher"==getParameterByName("team")?(teacherMode=!0,runTeacherMode()):(myTeam=parseInt(getParameterByName("team")))<1||myTeam>numTeams||isNaN(myTeam)?($("#selectTeam").show(),$("#loadingDiv").hide()):($("#loadingDiv").show(),loadGame())}function loadGame(){$("#loadingDiv").show(),updateState(),drawKey()}function tutorialCheck(){$("#introDivs").hide(),1500==year?(runTutorial(),clearInterval(turnCountdown)):1900==year?($("#mainGame").show(),endGame()):$("#mainGame").show()}function runTutorial(){tutorialMode=!0,$("#tutorialDiv").show()}function runTeacherMode(){$("#introDivs").hide(),$("#loadingDiv").show(),db.ref("worlds/"+worldCode+"/state/").on("value",function(e){squares=e.val().squares,year=e.val().year,nextUp=e.val().nextUp,turnHistory=e.val().turnHistory,paused=e.val().paused,"claim"==document.getElementById("colorBy").value&&colorSquaresClaim(),showTurnHistory(),showScores(),$("#loadingDiv").hide(),document.getElementById("year").innerHTML="Year "+year+" - ",document.getElementById("turn").innerHTML=lookupTeamName(nextUp)+"'s turn",paused&&($("#teacherPause").hide(),$("#teacherResume").show())}),drawKey(),$("#mainGame").show(),$("#uiTop2").hide(),$("#teacherUI").show()}function pauseBtn(){$("#teacherPause").hide(),$("#teacherResume").show(),db.ref("worlds/"+worldCode+"/state/").update({paused:!0})}function resumeBtn(){$("#teacherPause").show(),$("#teacherResume").hide(),db.ref("worlds/"+worldCode+"/state/").update({paused:!1})}function skipTurn(){squaresThisTurn="s0",nextUp==numTeams&&1895==year?(db.ref("worlds/"+worldCode+"/state/").update({squares:squares,year:1900,turnHistory:turnHistory+"t"+nextUp+squaresThisTurn}),endGame()):(nextUp==numTeams&&(nextUp=0,year=years[years.indexOf(year)+1]),db.ref("worlds/"+worldCode+"/state/").update({squares:squares,nextUp:nextUp+1,year:year,turnHistory:turnHistory+"t"+nextUp+squaresThisTurn}))}function fillTable(){var e='<table id="mapTable" border="1" cellspacing="0" cellpadding="0" style="width:600px"><tr>';for(i=1;i<=256;i++){var a="images/map_slices/africa_"+i.toString()+".png";e+='<td class="africaMapSquare" id="africaMapSquare'+i+'"><img class="africaMapSquarePic" id="africaMapSquarePic'+i+'" src="'+a+'" width="36px"><span class="africaMapSquareNum">'+i+"</span></td>",i%16==0&&(e+="</tr><tr>")}e=e.substring(0,e.length-4)+"</table>",document.getElementById("africaMapTable").innerHTML=e,toggleNumbers(),squares=document.getElementsByClassName("africaMapSquare"),fillResources(),findLandSquares()}function findLandSquares(){for(i=1;i<=256;i++){var e=document.getElementById("africaMapSquare"+i);0!=mapDataArray[i].landType&&(e.className+=" tooltip")}}function createTooltip(e){var a="<b>Square "+e+"</b><br>Claimed by "+lookupTeamName(squares[e])+"<br><br>"+lookupClimateType(mapDataArray[e].climate)+" climate<br><br>Resources: ";if(mapDataArray[e].cattle+mapDataArray[e].ceramics+mapDataArray[e].diamond+mapDataArray[e].glass+mapDataArray[e].gold+mapDataArray[e].slaves+mapDataArray[e].textiles==0?a+="none":a+=resourceCountToString("Cattle",mapDataArray[e].cattle)+resourceCountToString("Ceramics",mapDataArray[e].ceramics)+resourceCountToString("Diamonds",mapDataArray[e].diamond)+resourceCountToString("Glass",mapDataArray[e].glass)+resourceCountToString("Gold",mapDataArray[e].gold)+resourceCountToString("Slaves",mapDataArray[e].slaves)+resourceCountToString("Textiles",mapDataArray[e].textiles),!teacherMode)if(1==claimableSquares[e])if(nextUp==myTeam){var t="claimSquare("+e+');$(".tooltip").tooltipster("close")';a+="<br><br><button class='button' style='width: 100%; background-color:"+lookupTeamColor(myTeam)+"' onclick="+t+">Claim this square</button>"}else a+="<br><br>You can claim this<br>on your next turn.";else a+="<br><br>"+claimableSquares[e];return a}function lookupTeamName(e){return["no one","Britain","France","Belgium","Spain","Germany","Italy","Portugal"][e]}function lookupClimateType(e){switch(e){case"":return"";case"1":return"Rainforest";case"2":return"Savanna";case"3":return"Steppe";case"4":return"Desert";case"5":return"Mediterranean"}}function lookupTeamColor(e){return["#ffffff","#ffb1d8","#ffffa4","#976f6f","#49bf49","#3b6fff","#ff6666","#ad64ad"][e]}function resourceCountToString(e,a){switch(a){case"":return"";case"1":return"<br>&bull; "+e+" (few)";case"2":return"<br>&bull; "+e+" (some)";case"3":return"<br>&bull; "+e+" (many)"}}function fillResources(){var e=["cattle","ceramics","diamond","glass","gold","slaves","textiles"];for(j=0;j<=e.length;j++)for(i=1;i<256;i++)if(mapSquareHtml=document.getElementById("africaMapSquare"+i).innerHTML,mapDataArray[i][e[j]]>0){document.getElementById("africaMapSquare"+i).innerHTML+='<img class="africaMapResourcePic africaMapResourcePic'+i+'" src="images/resources/'+e[j]+'.gif" width="'+(5+4*mapDataArray[i][e[j]])+'px">';var a=document.getElementsByClassName("africaMapResourcePic"+i);1==a.length&&(a[0].style.left=18-a[0].width/2+"px",a[0].style.top=18-a[0].width/2+"px"),2==a.length&&(a[0].style.left=(18-a[0].width)/2+"px",a[1].style.left=18+(18-a[1].width)/2+"px",a[1].style.top=18-a[1].width/2+"px"),3==a.length&&(a[0].style.top=(18-a[0].width)/2+"px",a[1].style.top=(18-a[1].width)/2+"px",a[2].style.top=18+(18-a[2].width)/2+"px",a[2].style.left=18-a[2].width/2+"px"),4==a.length&&(a[2].style.left=(18-a[2].width)/2+"px",a[3].style.left=18+(18-a[3].width)/2+"px",a[3].style.top=18+(18-a[3].width)/2+"px")}}function claimSquare(e){if(myTeam!=nextUp)alert("It's not your turn!");else if(paused)alert("The game is paused!");else switch(claims--,squares[e]=myTeam,squaresThisTurn+="s"+e,"claim"==document.getElementById("colorBy").value&&colorSquaresClaim(),findClaimableSquares(),claims){case-1:case 0:endTurn();break;case 1:""!=squaresThisTurn&&(document.getElementById("thisTurn").innerHTML="Expand your colonies by <b>one more square</b>. You can only expand colonies to squares that share a side with an existing colony.");break;case 2:""!=squaresThisTurn&&(document.getElementById("thisTurn").innerHTML="Expand your colonies by <b>two more squares</b>. You can only expand colonies to squares that share a side with an existing colony.");break;case 3:""!=squaresThisTurn&&(document.getElementById("thisTurn").innerHTML="Expand your colonies by <b>three more squares</b>. You can only expand colonies to squares that share a side with an existing colony.")}}function endTurn(){claimableSecondAttempt=!1,nextUp==numTeams&&1895==year?(db.ref("worlds/"+worldCode+"/state/").update({squares:squares,year:1900,turnHistory:turnHistory+"t"+myTeam+squaresThisTurn}),clearInterval(turnCountdown),endGame()):(nextUp==numTeams&&(nextUp=0,year=years[years.indexOf(year)+1]),db.ref("worlds/"+worldCode+"/state/").update({squares:squares,nextUp:nextUp+1,year:year,turnHistory:turnHistory+"t"+myTeam+squaresThisTurn}),clearInterval(turnCountdown),squaresThisTurn="")}function colorSquaresClaim(){for(i=1;i<=256;i++){fillSquareClaim(document.getElementById("africaMapSquare"+i),squares[i])}}function fillSquareClaim(e,a){switch(a){case 0:e.style.backgroundColor="";break;case 1:e.style.backgroundColor="#ffb1d8";break;case 2:e.style.backgroundColor="#ffffa4";break;case 3:e.style.backgroundColor="#785555";break;case 4:e.style.backgroundColor="#49bf49";break;case 5:e.style.backgroundColor="#3b6fff";break;case 6:e.style.backgroundColor="#ff6666";break;case 7:e.style.backgroundColor="#985098"}}function colorSquaresClimate(){for(i=1;i<=256;i++){fillSquareClimate(document.getElementById("africaMapSquare"+i),mapDataArray[i].climate)}}function fillSquareClimate(e,a){switch(a){case"":e.style.backgroundColor="";break;case"1":e.style.backgroundColor="#1faf3e";break;case"2":e.style.backgroundColor="#b0fec2";break;case"3":e.style.backgroundColor="#e2aaff";break;case"4":e.style.backgroundColor="#fffca1";break;case"5":e.style.backgroundColor="#fece90"}}function updateState(){db.ref("worlds/"+worldCode+"/state/").on("value",function(e){squares=e.val().squares,year=e.val().year,nextUp=e.val().nextUp,turnHistory=e.val().turnHistory,paused=e.val().paused,"claim"==document.getElementById("colorBy").value&&colorSquaresClaim(),drawRightUI(),findClaimableSquares(),firstLoad&&tutorialCheck(),firstLoad=!1,1900==year&&endGame(),paused&&(document.getElementById("turn").innerHTML="The game is paused!")})}function turnTimer(){tutorialMode||(turnCountdown=setInterval(function(){paused?document.getElementById("turn").innerHTML="The game is paused!":(document.getElementById("turn").innerHTML=timeLeft>179?"<b>Your turn!</b> You have 3min "+(timeLeft-180)+"sec left.":timeLeft>119?"<b>Your turn!</b> You have 2min "+(timeLeft-120)+"sec left.":timeLeft>59?"<b>Your turn!</b> You have 1min "+(timeLeft-60)+"sec left.":"<b>Your turn!</b> You have "+timeLeft+"sec left.",--timeLeft<=-1&&(claims=1,claimSquare(0),clearInterval(turnCountdown),alert("You've run out of time! Your turn is over.")))},1e3))}function toggleColor(){1900!=year&&findClaimableSquares(),"claim"==document.getElementById("colorBy").value?colorSquaresClaim():colorSquaresClimate(),drawKey()}function generateWorldCode(){$("#loadingDiv").show();var e=(Math.random().toString(36)+"00000000000000000").slice(2,8).toUpperCase();db.ref("worlds/"+e).once("value").then(function(a){null!=a.val()?generateWorldCode():(squares=Array.apply(null,Array(257)).map(Number.prototype.valueOf,0),db.ref("worlds/"+e+"/state/").set({year:1500,squares:squares,nextUp:1,turnHistory:"0",paused:!1}),worldCode=e,$("#enterWorldCode").hide(),$("#loadingDiv").hide(),$("#createdWorldCode").show(),$("#numberOfTeams").show(),document.getElementById("createdWorldCode").innerHTML="<br>Your world code is <b>"+e+"</b>.")})}function toggleNumbers(){var e=document.getElementsByClassName("africaMapSquareNum");if(document.getElementById("cbShowNumbers").checked)for(i=0;i<e.length;i++)e[i].style.visibility="visible";else for(i=0;i<e.length;i++)e[i].style.visibility="hidden"}function toggleResources(){var e=document.getElementsByClassName("africaMapResourcePic");if(document.getElementById("cbShowResources").checked)for(i=0;i<e.length;i++)e[i].style.visibility="visible";else for(i=0;i<e.length;i++)e[i].style.visibility="hidden"}function findClaimableSquares(){var e=0,a=year;for(nextUp>myTeam&&(a=years[years.indexOf(year)+1]),i=1;i<=256;i++){var t=document.getElementById("africaMapSquare"+i);t.classList.remove("claimable"),1900==a?(claimableSquares[i]="Your last turn has passed.",e++):0==mapDataArray[i].landType?claimableSquares[i]="This square is all ocean.":0!=squares[i]?claimableSquares[i]="This square is<br>already claimed.":"1"==mapDataArray[i][1875]&&a<1875?claimableSquares[i]="This square is protected<br>by a powerful kingdom.":"2"==mapDataArray[i][1875]?claimableSquares[i]="Ethiopia is independent<br>and cannot be claimed.":"10"==teamDataArray[myTeam]["turn"+a]&&1!=mapDataArray[i].landType?claimableSquares[i]="This square is<br>not on the coast.":"10"==teamDataArray[myTeam]["turn"+a]||squares[i-1]==myTeam&&(i+15)%16!=0||squares[i+1]==myTeam&&i%16!=0||squares[i-16]==myTeam||squares[i+16]==myTeam?"0"==teamDataArray[myTeam]["turn"+a]?(claimableSquares[i]="You cannot claim<br>squares this turn.",e++):(claimableSquares[i]=!0,e++,"claim"==document.getElementById("colorBy").value&&t.classList.add("claimable")):claimableSquares[i]="This square doesn't share<br>a side with your colonies."}0==e&&nextUp==myTeam&&(claimableSecondAttempt?"0"!=teamDataArray[myTeam]["turn"+year]&&(teamDataArray[myTeam]["turn"+year]="0",console.log("No valid squares were found at all - nothing can be claimed this turn."),clearInterval(turnCountdown),drawRightUI()):""!=squaresThisTurn?endTurn():"10"==teamDataArray[myTeam]["turn"+year]?(teamDataArray[myTeam]["turn"+year]="1",claimableSecondAttempt=!0,console.log("No valid port squares were found, trying with an expansion instead."),clearInterval(turnCountdown),drawRightUI()):"1"!=teamDataArray[myTeam]["turn"+year]&&"2"!=teamDataArray[myTeam]["turn"+year]&&"3"!=teamDataArray[myTeam]["turn"+year]&&"4"!=teamDataArray[myTeam]["turn"+year]||(teamDataArray[myTeam]["turn"+year]="10",claimableSecondAttempt=!0,console.log("No valid expansion squares were found, trying with a port instead."),clearInterval(turnCountdown),drawRightUI()))}function countClaims(){switch(teamDataArray[myTeam]["turn"+year]){case"10":case"1":claims=1;break;case"2":claims=2;break;case"3":claims=3;break;case"4":claims=4;break;case"E":claims=7,claimSquare(27),claimSquare(28),claimSquare(43),claimSquare(44),claimSquare(45);break;case"0":claims=0}}function drawKey(){"claim"==document.getElementById("colorBy").value?document.getElementById("legendDiv").innerHTML='<img id="claimLegend" src="images/claimLegend'+numTeams+'.png" height="42px">':document.getElementById("legendDiv").innerHTML='<img id="climateLegend" src="images/climateLegend.png" height="42px">'}function drawRightUI(){showTurnHistory(),showScores(),document.getElementById("year").innerHTML="Year "+year+" - ",nextUp==myTeam?(document.getElementById("turnHeader").innerHTML="This Turn",timeLeft=1500==year?180:120,turnTimer(),countClaims(),findClaimableSquares()):(document.getElementById("turn").innerHTML=lookupTeamName(nextUp)+"'s turn",document.getElementById("turnHeader").innerHTML="Next Turn",clearInterval(turnCountdown));var e=years.length-years.indexOf(year)-1;document.getElementById("objectiveHeader").innerHTML="<img src='images/flags/"+teamDataArray[myTeam].name+".png' width='32px'></img>  "+teamDataArray[myTeam].name+"'s Objectives  <img src='images/flags/"+teamDataArray[myTeam].name+".png' width='32px'></img>",nextUp<=myTeam?(document.getElementById("turnsLeft").innerHTML=" ("+e+" turns left)",1==e&&(document.getElementById("turnsLeft").innerHTML=" (1 turn left)"),document.getElementById("teamObjective").innerHTML=year<1815?teamDataArray[0].obj1500+" "+teamDataArray[myTeam].obj1500:year<1875?teamDataArray[0].obj1815+" "+teamDataArray[myTeam].obj1815:teamDataArray[0].obj1875+" "+teamDataArray[myTeam].obj1875):(document.getElementById("turnsLeft").innerHTML=" ("+(e-1).toString()+" turns left)",2==e&&(document.getElementById("turnsLeft").innerHTML=" (1 turn left)"),document.getElementById("teamObjective").innerHTML=year<1800?teamDataArray[0].obj1500+" "+teamDataArray[myTeam].obj1500:year<1860?teamDataArray[0].obj1815+" "+teamDataArray[myTeam].obj1815:teamDataArray[0].obj1875+" "+teamDataArray[myTeam].obj1875),document.getElementById("teamObjective").innerHTML+=" Wherever you do claim land, you certainly wouldn't mind access to gold and diamonds.";var a=year;switch(nextUp>myTeam&&(1895==year&&(document.getElementById("thisTurn").innerHTML="You have completed your final turn in the Scramble for Africa."),a=years[years.indexOf(year)+1]),teamDataArray[myTeam]["turn"+a]){case"10":document.getElementById("thisTurn").innerHTML="Start a new colony.  New colonies must be started on the coast.";break;case"1":document.getElementById("thisTurn").innerHTML="Expand a colony by one square. You can only expand colonies to squares that share a side with an existing colony.";break;case"2":document.getElementById("thisTurn").innerHTML="Expand your colonies by a total of two squares. You can only expand colonies to squares that share a side with an existing colony.";break;case"3":document.getElementById("thisTurn").innerHTML="Expand your colonies by a total of three squares. You can only expand colonies to squares that share a side with an existing colony.";break;case"4":document.getElementById("thisTurn").innerHTML="Expand your colonies by a total of four squares. You can only expand colonies to squares that share a side with an existing colony.";break;case"E":document.getElementById("thisTurn").innerHTML="You claim all of Egypt in the northwest corner of Africa. You may also expand your colonies by a total of two squares. You can only expand colonies to squares that share a side with an existing colony.";break;case"0":document.getElementById("thisTurn").innerHTML=nextUp==myTeam?"You do not expand in Africa this turn. <button class='button' onclick='claimSquare(0)' style='background-color:"+lookupTeamColor(myTeam)+"'>Click here to continue.</button>":"You do not expand in Africa next turn."}}function showScores(){for(document.getElementById("scoresDiv").innerHTML="",j=1;j<numTeams+1;j++)document.getElementById("scoresDiv").innerHTML+=lookupTeamName(j)+": "+calculateScore(j)+"<br>"}function calculateScore(e){var a=0;for(i=1;i<=256;i++)if(squares[i]==e)switch(a++,a+=(parseInt(mapDataArray[i].gold)||0)+(parseInt(mapDataArray[i].diamonds)||0),e){case 1:i>167&&a++,a+=(parseInt(mapDataArray[i].slaves)||0)+(parseInt(mapDataArray[i].cattle)||0);break;case 2:i<119&&a++,a+=parseInt(mapDataArray[i].slaves)||0;break;case 3:"1"==mapDataArray[i].climate&&a++;break;case 4:"5"==mapDataArray[i].climate&&a++,i<119&&a++,a+=(parseInt(mapDataArray[i].ceramics)||0)+(parseInt(mapDataArray[i].glass)||0);break;case 5:"1"==mapDataArray[i].landType&&a++,a+=parseInt(mapDataArray[i].cattle)||0;break;case 6:a+=(parseInt(mapDataArray[i].ceramics)||0)+(parseInt(mapDataArray[i].glass)||0)+(parseInt(mapDataArray[i].textiles)||0)+(parseInt(mapDataArray[i].cattle)||0);break;case 7:"1"==mapDataArray[i].landType&&a++}switch(e){case 2:a=Math.ceil(1.142*a);break;case 3:a=Math.ceil(2.869*a);break;case 4:a=Math.ceil(1.702*a);break;case 5:a=Math.ceil(1.795*a);break;case 6:a=Math.ceil(2.105*a);break;case 7:a=Math.ceil(2.705*a)}return a}function endGame(){for(clearInterval(turnCountdown),year=1900,$(".tooltip").tooltipster("destroy"),i=1;i<=256;i++){var e=document.getElementById("africaMapSquare"+i);e.classList.remove("claimable"),e.classList.remove("tooltip")}for($("#mapOptions").hide(),document.getElementById("cbShowNumbers").checked=!1,toggleNumbers(),document.getElementById("cbShowResources").checked=!1,toggleResources(),document.getElementById("colorBy").value="claim",toggleColor(),$("#rightUI").hide(),$("#endGameDiv").show(),j=1;j<numTeams+1;j++)document.getElementById("finalScoresDiv").innerHTML+="<h2><img src='images/flags/"+teamDataArray[j].name+".png' width='32px'></img> "+lookupTeamName(j)+": "+calculateScore(j)+" points</h2>";document.getElementById("finalLegendDiv").innerHTML+='<img id="claimLegend" src="images/claimLegend'+numTeams+'.png" height="42px">'}function showRealAfrica(){$("#realAfrica").show(),$("#endGameDiv").hide()}function showTurnHistory(){var e=[],a=turnHistory.split("t");for(i=1;i<a.length;i++){var t=a[i].split("s");switch(e[i]=lookupTeamName(t[0]),t.length){case 2:"0"==t[1]?e[i]+=" did not claim a square":e[i]+=" claimed Square "+t[1];break;case 3:e[i]+=" claimed Squares "+t[1]+" and "+t[2];break;case 4:e[i]+=" claimed Squares "+t[1]+", "+t[2]+" and "+t[3];break;case 5:e[i]+=" claimed Squares "+t[1]+", "+t[2]+", "+t[3]+" and "+t[4];break;case 8:e[i]+=" claimed Squares "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+" and "+t[7]}}for(document.getElementById("turnHistoryDiv").innerHTML="",i=1;i<Math.min(numTeams+1,e.length);i++)document.getElementById("turnHistoryDiv").innerHTML+=e[e.length-i]+"<br>"}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function fillTableTutorial(){claimableSquaresTutorial=[0,!1,!1,!0,!1,!1,!1,!1,!0,!1,!1,!1,!1],landSquaresTutorial=[0,0,1,1,0,1,1,1,1,1,1,1,0],resourceSquaresTutorial=[0,"none","<br>&bull; cattle (some)","<br>&bull; ceramics (some)<br>&bull; diamond (many)",0,"<br>&bull; glass (few)","none","none","none","none","none","<br>&bull; slaves (many)",0];var e='<table id="mapTableTutorial" border="1" cellspacing="0" cellpadding="0" style="width:112px"><tr>';for(tutorialSquares=[0,256,191,192,256,207,208,222,223,224,238,239,240],i=1;i<=12;i++){var a="images/map_slices/africa_"+tutorialSquares[i].toString()+".png";e+='<td class="africaMapSquare" id="africaMapSquareTutorial'+i+'"><img class="africaMapSquarePic" id="africaMapSquareTutorialPic'+i+'" src="'+a+'" width="36px"></td>',i%3==0&&(e+="</tr><tr>")}e=e.substring(0,e.length-4)+"</table>",document.getElementById("africaMapTableTutorial").innerHTML=e,tutorialSquares=document.getElementsByClassName("africaMapSquare"),fillResourcesTutorial(),findLandSquaresTutorial()}function createTooltipTutorial(e){var a="<b>Square "+e+"</b><br>Claimed by no one<br><br>Savanna climate<br><br>Resources: ";if(mapDataArrayTutorial[e].cattle+mapDataArrayTutorial[e].ceramics+mapDataArrayTutorial[e].diamond+mapDataArrayTutorial[e].glass+mapDataArrayTutorial[e].gold+mapDataArrayTutorial[e].slaves+mapDataArrayTutorial[e].textiles==0?a+="none":a+=resourceCountToString("Cattle",mapDataArrayTutorial[e].cattle)+resourceCountToString("Ceramics",mapDataArrayTutorial[e].ceramics)+resourceCountToString("Diamonds",mapDataArrayTutorial[e].diamond)+resourceCountToString("Glass",mapDataArrayTutorial[e].glass)+resourceCountToString("Gold",mapDataArrayTutorial[e].gold)+resourceCountToString("Slaves",mapDataArrayTutorial[e].slaves)+resourceCountToString("Textiles",mapDataArrayTutorial[e].textiles),1==claimableSquaresTutorial[e]){var t="claimSquareTutorial("+e+');$(".tooltip").tooltipster("close")';a+="<br><br><button class='button' style='width: 100%; background-color:"+lookupTeamColor(myTeam)+"' onclick="+t+">Claim this square</button>"}else a+="<br><br>This square is not claimable.";return a}function claimSquareTutorial(e){claimableSquaresTutorial[e]=!1;var a=document.getElementById("africaMapSquareTutorial"+e);switch(a.classList.remove("claimable"),myTeam){case 0:a.style.backgroundColor="";break;case 1:a.style.backgroundColor="#ffb1d8";break;case 2:a.style.backgroundColor="#ffffa4";break;case 3:a.style.backgroundColor="#785555";break;case 4:a.style.backgroundColor="#49bf49";break;case 5:a.style.backgroundColor="#3b6fff";break;case 6:a.style.backgroundColor="#ff6666";break;case 7:a.style.backgroundColor="#985098"}claimableSquaresTutorial[3]||claimableSquaresTutorial[8]||($("#tutorial1").hide(),$("#tutorial2").show())}function findLandSquaresTutorial(){for(i=1;i<=12;i++){var e=document.getElementById("africaMapSquareTutorial"+i);3!=i&&8!=i||e.classList.add("claimable"),0!=landSquaresTutorial[i]&&(e.className+=" tooltip")}}function fillResourcesTutorial(){var e=["cattle","ceramics","diamond","glass","gold","slaves","textiles"];for(j=0;j<=e.length;j++)for(i=1;i<12;i++)if(mapSquareHtml=document.getElementById("africaMapSquareTutorial"+i).innerHTML,mapDataArrayTutorial[i][e[j]]>0){document.getElementById("africaMapSquareTutorial"+i).innerHTML+='<img class="africaMapResourcePic africaMapResourcePicTutorial'+i+'" src="images/resources/'+e[j]+'.gif" width="'+(5+4*mapDataArrayTutorial[i][e[j]])+'px">';var a=document.getElementsByClassName("africaMapResourcePicTutorial"+i);1==a.length&&(a[0].style.left=18-a[0].width/2+"px",a[0].style.top=18-a[0].width/2+"px"),2==a.length&&(a[0].style.left=(18-a[0].width)/2+"px",a[1].style.left=18+(18-a[1].width)/2+"px",a[1].style.top=18-a[1].width/2+"px")}}function endTutorial(){tutorialMode=!1,$("#mainGame").show(),$("#tutorialDiv").hide(),nextUp==myTeam&&(document.getElementById("turnHeader").innerHTML="This Turn",turnTimer())}function claimAllSquares(){for(i=0;i<256;i++)squares[i]=myTeam;db.ref("worlds/"+worldCode+"/state/").update({squares:squares})}gameIntro(),document.getElementById("worldCodeInBtn").onclick=function(){var e=document.getElementById("worldCodeIn").value.toUpperCase();""!=e&&($("#loadingDiv").show(),db.ref("worlds/"+e).once("value").then(function(a){null!=a.val()?(numTeams=a.val().teams,$("#worldCodeError").hide(),worldCode=e,document.getElementById("worldCodeInBtn").disabled=!0,$("#newWorldCode").hide(),getTeam()):($("#worldCodeError").show(),$("#loadingDiv").hide())}))},document.getElementById("teamSelectBtn").onclick=function(){document.getElementById("teamSelectBtn").disabled=!0,myTeam=parseInt(document.getElementById("teamSelect").value),loadGame()},document.getElementById("numberOfTeamsBtn").onclick=function(){for(numTeams=parseInt(document.getElementById("numberOfTeamsSelect").value),db.ref("worlds/"+worldCode+"/").update({teams:numTeams}),document.getElementById("numberOfTeams").innerHTML="<br>Here are links each team can use to log in directly to your world:<br><br>",i=1;i<=numTeams;i++){var e=window.location.href+"?world="+worldCode+"&team="+i;document.getElementById("numberOfTeams").innerHTML+="<img src='images/flags/"+teamDataArray[i].name+".png' width='32px'></img> "+lookupTeamName(i)+": <a href="+e+">"+e+"</a><br><br>"}var a=window.location.href+"?world="+worldCode+"&team=teacher";document.getElementById("numberOfTeams").innerHTML+="And here's the teacher link you should use to monitor the map, pause the game and skip turns as necessary:<br><a href="+a+">"+a+"</a>"};
